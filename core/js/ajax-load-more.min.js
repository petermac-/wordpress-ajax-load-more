/*
 * WordPress Ajax Load More
 * http://wordpress.org/plugins/ajax-load-more/
 * https://github.com/dcooney/wordpress-ajax-load-more
 *
 * Copyright 2015 Connekt Media - http://connekthq.com
 * Free to use under the GPLv2 license.
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * Author: Darren Cooney
 * Twitter: @KaptonKaos
*/

!function(a){"use strict";a.ajaxloadmore=function(t){"true"===alm_localize.scrolltop&&a(window).scrollTop(0);var e=this;e.AjaxLoadMore={},e.page=0,e.speed=300,e.proceed=!1,e.disable_ajax=!1,e.init=!0,e.loading=!0,e.finished=!1,e.window=a(window),e.button_label="",e.data,e.el=t,e.content=a(".alm-listing.alm-ajax",e.el),e.prefix="alm-",e.cache=e.content.attr("data-cache"),e.cache_id=e.content.attr("data-cache-id"),e.cache_path=e.content.attr("data-cache-path"),e.cache_logged_in=e.content.attr("data-cache-logged-in"),e.repeater=e.content.attr("data-repeater"),e.scroll_distance=parseInt(e.content.attr("data-scroll-distance")),e.max_pages=parseInt(e.content.attr("data-max-pages")),e.pause=e.content.attr("data-pause"),e.transition=e.content.attr("data-transition"),e.destroy_after=e.content.attr("data-destroy-after"),e.lang=e.content.attr("data-lang"),e.posts_per_page=e.content.attr("data-posts-per-page"),e.seo=e.content.attr("data-seo"),e.preloaded=e.content.attr("data-preloaded"),e.preloaded_amount=e.content.attr("data-preloaded-amount"),e.offset=void 0===e.content.attr("data-offset")?0:e.content.attr("data-offset"),void 0===e.cache&&(e.cache=!1),void 0===e.cache_logged_in&&(e.cache_logged_in=!1),"true"===e.preloaded&&(e.preload_wrap=e.content.prev(".alm-preloaded"),e.total_posts=parseInt(e.preload_wrap.attr("data-total-posts")),void 0===e.preloaded_amount&&(e.preloaded_amount=!1),e.total_posts<=e.preloaded_amount&&(e.disable_ajax=!0)),void 0===e.seo&&(e.seo=!1),"true"===e.seo&&(e.seo=!0),e.permalink=e.content.attr("data-seo-permalink"),e.start_page=e.content.attr("data-seo-start-page"),e.start_page&&(e.seo_scroll=e.content.attr("data-seo-scroll"),e.seo_scroll_speed=e.content.attr("data-seo-scroll-speed"),e.seo_scrolltop=e.content.attr("data-seo-scrolltop"),e.isPaged=!1,e.start_page>1&&(e.isPaged=!0,e.posts_per_page=e.start_page*e.posts_per_page)),(void 0===e.pause||e.seo&&e.start_page>1)&&(e.pause=!1),e.preloaded&&e.start_page>=1&&(e.pause=!1),void 0===e.repeater&&(e.repeater="default"),void 0===e.max_pages&&(e.max_pages=5),0===e.max_pages&&(e.max_pages=1e3),void 0===e.scroll_distance&&(e.scroll_distance=150),e.transition=void 0===e.transition?"slide":"fade"===e.transition?"fade":"none"===e.transition?"none":"slide",void 0!==e.destroy_after,e.button_label=void 0===e.content.attr("data-button-label")?"Older Posts":e.content.attr("data-button-label"),e.button_class=void 0===e.content.attr("data-button-class")?"":" "+e.content.attr("data-button-class"),e.scroll=void 0===e.content.attr("data-scroll")?!0:"false"===e.content.attr("data-scroll")?!1:!0,e.post_type=e.content.attr("data-post-type"),e.post_type=e.post_type.split(","),e.el.append('<div class="'+e.prefix+'btn-wrap"><div class="sk-spinner sk-spinner-wave"><div class="sk-rect1"></div><div class="sk-rect2"></div><div class="sk-rect3"></div><div class="sk-rect4"></div><div class="sk-rect5"></div></div><button id="load-more" class="'+e.prefix+"load-more-btn more"+e.button_class+'">'+e.button_label+"</button></div>"),e.button=a(".alm-load-more-btn",e.el),e.AjaxLoadMore.loadPosts=function(){if(!e.disable_ajax)if(e.button.addClass("loading"),e.loading=!0,"true"!==e.cache||e.cache_logged_in)e.AjaxLoadMore.ajax();else if(e.init&&e.seo&&e.isPaged)e.AjaxLoadMore.ajax();else{var t=e.cache_path+"/page-"+e.page+".html";a.get(t,function(a){e.AjaxLoadMore.success(a)}).fail(function(){e.AjaxLoadMore.ajax()})}},e.AjaxLoadMore.ajax=function(){a.ajax({type:"GET",url:alm_localize.ajaxurl,data:{action:"ajax_load_more_init",nonce:alm_localize.alm_nonce,cache_id:e.cache_id,repeater:e.repeater,postType:e.post_type,post_format:e.content.attr("data-post-format"),category:e.content.attr("data-category"),category__not_in:e.content.attr("data-category-not-in"),tag:e.content.attr("data-tag"),tag__not_in:e.content.attr("data-tag-not-in"),taxonomy:e.content.attr("data-taxonomy"),taxonomy_terms:e.content.attr("data-taxonomy-terms"),taxonomy_operator:e.content.attr("data-taxonomy-operator"),meta_key:e.content.attr("data-meta-key"),meta_value:e.content.attr("data-meta-value"),meta_compare:e.content.attr("data-meta-compare"),author:e.content.attr("data-author"),year:e.content.attr("data-year"),month:e.content.attr("data-month"),day:e.content.attr("data-day"),post_status:e.content.attr("data-post-status"),order:e.content.attr("data-order"),orderby:e.content.attr("data-orderby"),post__in:e.content.attr("data-post-in"),exclude:e.content.attr("data-exclude"),search:e.content.attr("data-search"),posts_per_page:e.posts_per_page,pageNumber:e.page,offset:e.offset,preloaded:e.preloaded,preloaded_amount:e.preloaded_amount,seo_start_page:e.start_page,lang:e.lang},dataType:"html",beforeSend:function(){1!=e.page&&e.button.addClass("loading")},success:function(a){e.AjaxLoadMore.success(a)},error:function(a,t,o){e.AjaxLoadMore.error(a,t,o)}})},e.AjaxLoadMore.success=function(t){if(e.data=a(t),e.init&&(e.button.text(e.button_label),e.init=!1,!e.data.length>0&&a.isFunction(a.fn.almEmpty)&&a.fn.almEmpty(e),e.isPaged&&(e.posts_per_page=e.content.attr("data-posts-per-page"),e.page=e.start_page-1)),e.data.length>0?(e.el=a('<div class="'+e.prefix+'reveal"/>'),e.el.append(e.data).hide(),e.content.append(e.el),"fade"===e.transition?e.el.fadeIn(e.speed,"alm_easeInOutQuad",function(){e.loading=!1,e.button.delay(e.speed).removeClass("loading"),e.data.length<e.posts_per_page&&(e.finished=!0,e.button.addClass("done"))}):"none"===e.transition?(e.el.show(),e.loading=!1,e.button.delay(e.speed).removeClass("loading"),e.data.length<e.posts_per_page&&(e.finished=!0,e.button.addClass("done"))):e.el.slideDown(e.speed,"alm_easeInOutQuad",function(){e.loading=!1,e.button.delay(e.speed).removeClass("loading"),e.data.length<e.posts_per_page&&(e.finished=!0,e.button.addClass("done"))}),a.isFunction(a.fn.almComplete)&&a.fn.almComplete(e),1===a(".ajax-load-more-wrap").length&&a.isFunction(a.fn.almSEO)&&e.seo&&a.fn.almSEO(e)):(e.button.delay(e.speed).removeClass("loading").addClass("done"),e.loading=!1,e.finished=!0),void 0!==e.destroy_after&&""!==e.destroy_after){var o=e.page+1;e.preload&&o++,o==e.destroy_after&&(e.disable_ajax=!0,e.button.delay(e.speed).fadeOut(e.speed))}},e.AjaxLoadMore.error=function(a,t,o){e.loading=!1,e.button.removeClass("loading"),console.log(o)},e.button.on("click",function(){"true"===e.pause&&(e.pause=!1,e.AjaxLoadMore.loadPosts()),e.loading||e.finished||a(this).hasClass("done")||(e.loading=!0,e.page++,e.AjaxLoadMore.loadPosts())}),e.AjaxLoadMore.isVisible=function(){return e.visible=!1,e.el.is(":visible")&&(e.visible=!0),e.visible},e.scroll&&e.window.bind("scroll touchstart",function(){if(e.AjaxLoadMore.isVisible()){var a=e.button.offset();!e.loading&&!e.finished&&e.window.scrollTop()>=Math.round(a.top-(e.window.height()-e.scroll_distance))&&e.page<e.max_pages-1&&e.proceed&&"true"!==e.pause&&(e.page++,e.AjaxLoadMore.loadPosts())}}),e.disable_ajax?(e.finished=!0,e.button.addClass("done")):"true"===e.pause?(e.button.text(e.button_label),e.loading=!1):e.AjaxLoadMore.loadPosts(),setTimeout(function(){e.proceed=!0},1e3),a.easing.alm_easeInOutQuad=function(a,t,e,o,n){return(t/=n/2)<1?o/2*t*t+e:-o/2*(--t*(t-2)-1)+e}},a.fn.almFilter=function(t,e,o){a(".ajax-load-more-wrap").each(function(){var n=a(this);"slide"===t?n.slideUp(e,function(){a(".alm-listing",n).html(""),a(".alm-btn-wrap",n).remove(),n.fadeIn(e),a.fn.almSetFilters(n,o)}):"fade"===t?n.fadeOut(e,function(){a(".alm-listing",n).html(""),a(".alm-btn-wrap",n).remove(),n.fadeIn(e),a.fn.almSetFilters(n,o)}):(a(".alm-listing",n).html(""),a(".alm-btn-wrap",n).remove(),n.fadeIn(e),a.fn.almSetFilters(n,o))})},a.fn.almSetFilters=function(t,e){a.each(e,function(e,o){e=e.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2"),a(".alm-listing",t).attr("data-"+e,o)}),a.isFunction(a.fn.almFilterComplete)&&a.fn.almFilterComplete(),a(".ajax-load-more-wrap").ajaxloadmore()},a.fn.ajaxloadmore=function(){return this.each(function(){a(this).data("alm",new a.ajaxloadmore(a(this)))})},a(".ajax-load-more-wrap").length&&a(".ajax-load-more-wrap").ajaxloadmore()}(jQuery);